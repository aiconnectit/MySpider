C51 COMPILER V9.54   KEY                                                                   02/20/2020 19:45:47 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\list\Key.obj
COMPILER INVOKED BY: D:\MDK5\C51\BIN\C51.EXE Key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\list\Key.lst) TAB
                    -S(2) OBJECT(.\list\Key.obj)

line level    source

   1          #include "Key.h"
   2          #include "Delay.h"
   3          
   4          
   5          code uChar8 RowScanVal[4] = {0xfe, 0xfd, 0xfb, 0xf7}; //é”®ç›˜é€è¡Œæ‰«æå€¼
   6          /**********************************************************
   7          å‡½æ•°åç§°ï¼šGetKeyVal_Button
   8          å‡½æ•°åŠŸèƒ½ï¼šè¯»å–ç‹¬ç«‹æŒ‰é”®ï¼Œä»…é‡‡é›†æŒ‰ä¸‹åŠ¨ä½œï¼Œè¿”å›æŒ‰é”®å­—é¢å€¼
   9          å…¥å£å‚æ•°ï¼šæ— 
  10          å‡ºå£å‚æ•°ï¼šKeyValæŒ‰ä¸‹é”®çš„å­—é¢å€¼
  11          å¤‡æ³¨ï¼š
  12          **********************************************************/
  13          uChar8 GetKeyVal_Button(void) //ç‹¬ç«‹å¼æŒ‰é”®è¯»å–é”®å€¼å‡½æ•°
  14          {
  15   1        static uChar8 k4_old = 0x0f;    //ä¸Šæ¬¡æŒ‰é”®ç”µå¹³å€¼
  16   1        static KeyState_T S6State = NoKey;  //S6å¾®çŠ¶æ€
  17   1        static uChar8 S6_LOW_cnt = 0;   //S6ä½ç”µå¹³è®¡æ—¶å™¨
  18   1        uChar8 k4_now, tmp, KeyVal;
  19   1        
  20   1        P3 = 0xff;
  21   1        Delay5US();
  22   1        k4_now = P3 & 0x0f;   //è¯»å–æŒ‰é”®å€¼ï¼ˆä½å››ä½ï¼‰
  23   1        
  24   1        tmp = k4_old ^ k4_now;  //å¼‚æˆ–æ±‚å˜åŒ–ï¼Œæœ‰å˜åŒ–çš„ä½ä¸º1
  25   1        if(tmp)         //è‹¥æŒ‰é”®æœ‰æ–°åŠ¨ä½œï¼Œä¸æ”¯æŒç»„åˆé”®ï¼Œä»…å¯¹æŒ‰é”®æŒ‰ä¸‹æœ‰å“åº”
  26   1        {
  27   2          S6_LOW_cnt = 0;   
  28   2          switch(tmp)
  29   2          {
  30   3            case 0x01:  if(S7)
  31   3                    KeyVal = NOKEY;   //S7æ¾å¼€
  32   3                  else
  33   3                    KeyVal = S7DOWN;  //S7æŒ‰ä¸‹
  34   3                  break;
  35   3            case 0x02:  if(S6)
  36   3                    KeyVal = NOKEY;   //S6æ¾å¼€
  37   3                  else
  38   3                  {
  39   4                    KeyVal = S6DOWN;  //S6æŒ‰ä¸‹
  40   4                    S6State = KeyDown;
  41   4                  }
  42   3                  break;
  43   3            case 0x04:  if(S5)
  44   3                    KeyVal = NOKEY;   //S5æ¾å¼€
  45   3                  else
  46   3                    KeyVal = S5DOWN;  //S5æŒ‰ä¸‹
  47   3                  break;
  48   3            case 0x08:  if(S4)
  49   3                    KeyVal = NOKEY;   //S4æ¾å¼€
  50   3                  else
  51   3                    KeyVal = S4DOWN;  //S4æŒ‰ä¸‹
  52   3                  break;
  53   3            default:  KeyVal = NOKEY; 
  54   3                  break;
C51 COMPILER V9.54   KEY                                                                   02/20/2020 19:45:47 PAGE 2   

  55   3          }
  56   2        }
  57   1        else    //æ— å˜åŒ–ï¼Œéœ€è¦è€ƒè™‘S6é•¿æŒ‰
  58   1        {
  59   2          if(!S6)
  60   2          {
  61   3            if(S6State == KeyDown)
  62   3            {
  63   4              if(++ S6_LOW_cnt == 80) //0.8ç§’
  64   4              {
  65   5                S6State = KeyHold;
  66   5                KeyVal = S6HOLD;
  67   5              }
  68   4              else
  69   4                KeyVal = NOKEY;   //ä¸åˆ°0.8ç§’
  70   4            }
  71   3            else if(S6State == KeyHold) //è¶…è¿‡0.8ç§’
  72   3              KeyVal = S6HOLD;
  73   3          }
  74   2          KeyVal = NOKEY;
  75   2        } 
  76   1        k4_old = k4_now;  //å¤‡ä»½æœ¬æ¬¡æŒ‰é”®ç”µå¹³å€¼
  77   1        return KeyVal;
  78   1      }
  79          
  80          /**********************************************************
  81          å‡½æ•°åç§°ï¼šGetKeyVal_Keyboard
  82          å‡½æ•°åŠŸèƒ½ï¼šè¯»å–å½“å‰è¡Œçš„æŒ‰é”®ç”µå¹³ï¼Œå¯¹æ¯”ä¸Šæ¬¡è¯¥è¡Œçš„ç”µå¹³å€¼
  83          ä»…é‡‡é›†æŒ‰ä¸‹åŠ¨ä½œï¼Œè¿”å›æŒ‰é”®å­—é¢å€¼ï¼Œå¹¶æ‰«æä¸‹ä¸€è¡ŒæŒ‰é”®
  84          å…¥å£å‚æ•°ï¼šæ— 
  85          å‡ºå£å‚æ•°ï¼šKeyValæŒ‰ä¸‹é”®çš„å­—é¢å€¼
  86          å¤‡æ³¨ï¼šä¸æ”¯æŒç»„åˆé”®
  87          **********************************************************/
  88          uChar8 GetKeyVal_Keyboard(void) //è¡Œåˆ—å¼æŒ‰é”®è¯»å–é”®å€¼å‡½æ•°
  89          {
  90   1        static uChar8 column_old[4] = {0xf0, 0xf0, 0xf0, 0xf0}; //å¤‡ä»½çš„ä¸Šæ¬¡è¯»å–åˆ—çš„ç”µå¹³å€¼ï¼Œå…±4è¡Œã
             -€‚
  91   1                                  //å‡½æ•°æ¯æ‰§è¡Œä¸€æ¬¡ï¼Œå¤‡ä»½ä¸€è¡Œå³æ›´æ–°ä¸€ä¸ªå…ƒç´ 
  92   1        static uChar8 row_i = 0;  //å½“å‰è¡Œç´¢å¼•
  93   1        
  94   1        uChar8 column_now, tmp, col, colrow, KeyVal;
  95   1        
  96   1        col = 0x80;
  97   1        column_now = P3 & 0xf0;   //è¯»å–å½“å‰è¡Œå¯¹åº”çš„åˆ—ç”µå¹³å€¼ï¼Œé«˜å››ä½æœ‰æ•ˆ
  98   1        
  99   1        tmp = column_now ^ column_old[row_i]; //å¼‚æˆ–æ±‚å˜åŒ–ï¼Œæœ‰å˜åŒ–çš„ä½ä¸º1
 100   1        
 101   1        if(tmp)     //æœ‰å˜åŒ–
 102   1        {
 103   2          while(tmp <<= 1)
 104   2            col >>= 1;    //ç¡®å®šåˆ—å·
 105   2          if(col & column_now)
 106   2            KeyVal = NOKEY; //æ¾å¼€
 107   2          else
 108   2          {
 109   3            colrow = col | (1 << row_i);  //ç»„æˆè¡Œåˆ—å€¼
 110   3            switch(colrow)
 111   3            {
 112   4              case 0x88:  KeyVal = S4DOWN; break;
 113   4              case 0x84:  KeyVal = S5DOWN; break;
 114   4              case 0x82:  KeyVal = S6DOWN; break;
 115   4              case 0x81:  KeyVal = S7DOWN; break;
C51 COMPILER V9.54   KEY                                                                   02/20/2020 19:45:47 PAGE 3   

 116   4              case 0x48:  KeyVal = S8DOWN; break;
 117   4              case 0x44:  KeyVal = S9DOWN; break;
 118   4              case 0x42:  KeyVal = S10DOWN; break;
 119   4              case 0x41:  KeyVal = S11DOWN; break;
 120   4              case 0x28:  KeyVal = S12DOWN; break;
 121   4              case 0x24:  KeyVal = S13DOWN; break;
 122   4              case 0x22:  KeyVal = S14DOWN; break;
 123   4              case 0x21:  KeyVal = S15DOWN; break;
 124   4              case 0x18:  KeyVal = S16DOWN; break;
 125   4              case 0x14:  KeyVal = S17DOWN; break;
 126   4              case 0x12:  KeyVal = S18DOWN; break;
 127   4              case 0x11:  KeyVal = S19DOWN; break;
 128   4              default: KeyVal = NOKEY; break;
 129   4            }
 130   3          }
 131   2          
 132   2        }
 133   1        else      //æ— å˜åŒ–
 134   1        {
 135   2          KeyVal = NOKEY;
 136   2        }
 137   1        column_old[row_i++] = column_now; //å¤‡ä»½å½“å‰è¡Œæ‰«æå€¼
 138   1        P3 = RowScanVal[row_i];       //æ‰«æä¸‹ä¸€è¡Œ
 139   1        return KeyVal;
 140   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    348    ----
   CONSTANT SIZE    =      4    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
